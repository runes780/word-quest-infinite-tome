# Word Quest TODO（执行清单）

> 对应路线图：`ROADMAP.md`  
> 基线日期：2026-02-08  
> 维护规则：完成即勾选，延期需写原因

---

## 本周优先（2026-02-09 ~ 2026-02-16）

- [x] 建立 mastery 状态机字段与迁移脚本（new/learning/consolidated/mastered）
- [x] 把题目排序逻辑从 `accuracy` 升级为 `mastery + FSRS + recent mistakes`
- [x] 导师触发策略加入“重复错因”与“高风险到期卡”判断
- [x] 为 mastery 升级事件增加奖励和可视化反馈
- [x] 为 battle/srs/daily 三入口补齐统一回归测试
- [x] 家长面板新增“连续高强度干预预警”（基于定向复习连续低正确率）

---

## Phase 0（已完成）

- [x] 统一题目协议与运行时兜底（`questionMode` / `correctAnswer` / `skillTag` / `difficulty`）
- [x] 修复 typing/fill-blank 的 `wrongAnswer undefined` 污染
- [x] 增加 `learningEvents` 表并接入 battle/srs/daily
- [x] `updatePlayerProfile` 支持原子增量与 mastery delta
- [x] OpenRouter 限速改为全局共享调度
- [x] 成就弹窗链路接线完成
- [x] OCR 文案改为演示模式说明

---

## Phase 1：学习效果强化（2026-02-09 ~ 2026-02-23）

### 数据与算法
- [x] 新增 mastery 聚合任务（按日或按会话）
- [x] 定义 mastery 迁移规则（升/降级阈值）
- [x] 引入低样本平滑，避免 mastery 抖动
- [x] 题目调度加入 mastery 权重

### 导师干预
- [x] 触发条件支持：高难技能错误
- [x] 触发条件支持：重复错因（近 N 次）
- [x] 触发条件支持：FSRS 高风险卡错误
- [x] 导师输出新增“错因标签 + 下一步行动”

### 验收
- [x] 题型分布抽样 100 题符合 50/30/20
- [ ] 重复错因率较基线下降 >= 20%（已接入 7/14/30 天基线对比 + 自动达标判定）
- [x] 新增测试：mastery 迁移与排序结果稳定
- [x] 新增测试：连续低正确率可触发高强度预警策略

---

## Phase 2：任务线与动机深化（2026-02-24 ~ 2026-03-20）

### 任务线系统
- [x] 设计任务实体（目标/进度/期限/奖励/证据）
- [x] 任务线 UI（主线 + 每日）
- [x] 任务进度自动消费 `learningEvents`

### 每日挑战与奖励重构
- [x] 每日挑战接入任务线
- [x] 降低随机奖励占比（保底策略）
- [x] 增加“弱点突破奖励”“复习完成奖励”
- [x] 验收指标看板接入（参与率/任务完成率/次日留存，含对比窗口）

### 验收
- [ ] 每日挑战参与率提升 >= 15%
- [ ] 任务完成率 >= 60%
- [ ] 次日留存提升 >= 5%

---

## Phase 3：家校协同与可解释性（2026-03-21 ~ 2026-04-10）

### 建议引擎
- [x] 生成“今晚复习计划”建议卡（技能、题量、时长）
- [x] 建议优先级策略（紧急/重要/可选）
- [x] 建议执行后回写执行结果

### 证据链与报告
- [x] 每条建议绑定错题证据
- [x] 每条建议绑定 FSRS 到期证据
- [x] 面板增加 7/14/30 天对比
- [x] 导出报告新增“计划 vs 完成”

### 验收
- [ ] 家长面板周活提升 >= 20%
- [ ] 建议执行率 >= 40%

---

## Phase 4：规模化基础（2026-04-11 ~ 2026-05-15）

### 架构与质量
- [ ] `gameStore` 按领域拆分（learning/combat/economy）
- [ ] `BattleInterface` 拆分子模块
- [ ] 建立学习主流程 E2E（mission -> battle -> srs -> report）
- [ ] 增加数据一致性巡检（events/profile/dashboard）

### 性能与稳定性
- [ ] 离线缓存策略评估（容量与淘汰）
- [ ] API 失败重试与限速监控指标落库
- [ ] 会话恢复成功率监控

### 验收
- [ ] 主流程 E2E 全绿
- [ ] 无 429 风暴
- [ ] 会话恢复成功率达标

---

## 研发治理（持续项）

- [ ] 所有新功能必须附带验收指标
- [ ] 所有数据字段变更必须补迁移与回归
- [ ] 每周固定更新 `ROADMAP.md` 与本 TODO
- [ ] 发布前执行：`tsc --noEmit` + `npm test` + 关键路径手测
